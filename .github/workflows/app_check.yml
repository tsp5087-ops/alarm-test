name: ëª¨ë°”ì¼ ì•± ìƒì¡´ ì‹ ê³  ğŸ“±

on:
  schedule:
    - cron: '*/30 * * * *'  # 30ë¶„ë§ˆë‹¤ ì‹¤í–‰
  workflow_dispatch:        # ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼

jobs:
  mobile-test:
    runs-on: self-hosted   # ğŸ‘ˆ [ì¤‘ìš”] ë‚´ PCì—ì„œ ì‹¤í–‰í•˜ê² ë‹¤ëŠ” ëœ»!
    
    steps:
    - name: ì½”ë“œ ê°€ì ¸ì˜¤ê¸° ğŸ“¥
      uses: actions/checkout@v3

    - name: íŒŒì´ì¬ ì„¸íŒ… ğŸ
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: í•„ìš” ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
      run: pip install Appium-Python-Client selenium

    - name: ì•± ë¡œê·¸ì¸ 10ë²ˆ ì‹œë„ (ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë°œìƒ) ğŸ‘Š
      env:
        MY_ID: ${{ secrets.MY_ID }}    # ê¹ƒí—ˆë¸Œ ê¸ˆê³ ì˜ ì•„ì´ë””
        MY_PW: ${{ secrets.MY_PW }}    # ê¹ƒí—ˆë¸Œ ê¸ˆê³ ì˜ ë¹„ë²ˆ
      run: python app_monitor.py

    - name: (ì „ë¶€ ì‹¤íŒ¨ ì‹œ) ìŠ¬ë™ ì•Œë¦¼ ë°œì†¡ ğŸš¨
      if: failure()  # ğŸ‘ˆ ìœ„ ë‹¨ê³„ì—ì„œ ì—ëŸ¬ê°€ ë‚˜ë©´(10ë²ˆ ë‹¤ ì‹¤íŒ¨í•˜ë©´) ì‹¤í–‰ë¨
      run: |
         curl -H "Content-Type: application/json" \
              -d '{"text": "ğŸš¨ **[ì•± ë¹„ìƒ]** 1ë¶„ ë™ì•ˆ 10ë²ˆì´ë‚˜ ë¡œê·¸ì¸ì„ ì‹œë„í–ˆì§€ë§Œ ëª¨ë‘ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤! ì•± ì„œë²„ë‚˜ ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”."}' \
              ${{ secrets.SLACK_WEBHOOK_URL }}
