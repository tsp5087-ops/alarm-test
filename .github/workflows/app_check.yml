name: ëª¨ë°”ì¼ ì•± ìƒì¡´ ì‹ ê³  ğŸ“±

on:
  schedule:
    - cron: '*/30 * * * *'  # 30ë¶„ë§ˆë‹¤ ì‹¤í–‰
  workflow_dispatch:        # ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼

jobs:
  mobile-test:
    runs-on: [self-hosted, Windows, X64]
    
    steps:
    - name: ì½”ë“œ ê°€ì ¸ì˜¤ê¸° ğŸ“¥
      uses: actions/checkout@v3

    - name: íŒŒì´ì¬ ì„¸íŒ… ğŸ
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: í•„ìš” ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
      run: pip install Appium-Python-Client selenium

    - name: ì•± ë¡œê·¸ì¸ 10ë²ˆ ì‹œë„ (ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë°œìƒ) ğŸ‘Š
      env:
        MY_ID: ${{ secrets.MY_ID }}    # ê¹ƒí—ˆë¸Œ ê¸ˆê³ ì˜ ì•„ì´ë””
        MY_PW: ${{ secrets.MY_PW }}    # ê¹ƒí—ˆë¸Œ ê¸ˆê³ ì˜ ë¹„ë²ˆ
      run: python app_monitor.py

    - name: (ì „ë¶€ ì‹¤íŒ¨ ì‹œ) ìŠ¬ë™ ì•Œë¦¼ ë°œì†¡ ğŸš¨
      if: failure()
      shell: powershell   # ğŸ‘ˆ ìœˆë„ìš° íŒŒì›Œì…¸ ëª¨ë“œ ê°•ì œ ì ìš©
      run: |
        $headers = @{ "Content-Type" = "application/json" }
        $body = '{"text": "ğŸš¨ **[ì•± ë¹„ìƒ]** 1ë¶„ ë™ì•ˆ 10ë²ˆ ì‹œë„ ì‹¤íŒ¨! ì„œë²„ ì ê²€ ìš”ë§."}'
        Invoke-RestMethod -Uri "${{ secrets.SLACK_WEBHOOK_URL }}" -Method Post -Headers $headers -Body $body
